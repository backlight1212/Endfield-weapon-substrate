<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»ˆæœ«åœ°æ­¦å™¨åŸºè´¨ç­›é€‰å™¨</title>
    <style>
        :root {
            --bg-body: #f5f7fa; /* TableConvert é£æ ¼æµ…ç°èƒŒæ™¯ */
            --bg-block: #ffffff;
            --text-main: #333333;
            --text-dim: #666666;
            --accent: #007bff;
            --border: #e2e8f0;
            
            /* ç¨€æœ‰åº¦é¢œè‰²æ˜ å°„ */
            --color-çº¢è‰²: #ff4d4f;
            --color-é‡‘è‰²: #faad14;
            --color-ç´«è‰²: #a335ee;
            --color-ç™½è‰²: #999999;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            padding: 20px;
        }

        .main-container { max-width: 900px; margin: 0 auto; }
        
        h1 { text-align: center; font-weight: 500; margin-bottom: 30px; }

        /* ç™½è‰²åŒºå—åˆ†å‰² */
        .white-block {
            background: var(--bg-block);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .block-header {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }

        /* ç­›é€‰æŒ‰é’® */
        .filter-row { margin-bottom: 15px; }
        .filter-label { font-size: 0.85rem; color: var(--text-dim); margin-bottom: 8px; }
        .filter-tags { display: flex; flex-wrap: wrap; gap: 8px; }
        
        .tag-btn {
            background: #fff;
            border: 1px solid var(--border);
            padding: 5px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }
        .tag-btn:hover { background: #f8f9fa; }
        .tag-btn.active {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent);
        }

        /* è£…å¤‡å¡ç‰‡ */
        .item-card {
            display: flex;
            background: var(--bg-block);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 12px;
            height: 90px; /* æ¢å¤åŸæ¥çš„é«˜åº¦ */
            align-items: center;
            overflow: hidden;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .rarity-line { width: 6px; height: 100%; flex-shrink: 0; }
        
        .item-icon {
            width: 90px; /* æ¢å¤è¾ƒå¤§çš„å›¾æ ‡åŒºåŸŸ */
            height: 90px;
            background: #f8f9fa;
            border-right: 1px solid var(--border);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .item-icon img { width: 80%; height: 80%; object-fit: contain; }

        /* ç”µè„‘ç«¯ä¿¡æ¯å®¹å™¨ï¼šå‚ç›´æ’åˆ—ï¼ˆåå­—åœ¨ä¸Šï¼Œè¯æ¡åœ¨ä¸‹ï¼‰ */
        .item-info-box {
            flex: 1;
            padding: 0 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 8px; /* åå­—å’Œè¯æ¡ä¹‹é—´çš„é—´è· */
            min-width: 0;
        }

        .item-name { 
            font-weight: 600; 
            font-size: 1.1rem; 
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .item-affixes {
            display: flex;
            gap: 15px; /* è¯æ¡ä¹‹é—´å®½æ•çš„é—´è· */
        }
        .affix-text { font-size: 0.9rem; color: var(--text-dim); }
        .affix-text.match { color: var(--accent); font-weight: bold; }

        .item-farm-check {
            width: 100px;
            padding: 0 15px;
            border-left: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        /* ä¿®æ”¹å‹¾é€‰æ¡†æœ¬èº«çš„å¤§å° */
        .item-farm-check input[type="checkbox"] {
            width: 18px;  /* ä½ å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´è¿™ä¸ªæ•°å€¼ */
            height: 18px; /* ä¿æŒå®½é«˜ä¸€è‡´ */
            cursor: pointer;
            margin: 0;    /* æ¸…é™¤é»˜è®¤å¤–è¾¹è· */
        }

        /* --- ğŸ“± æ‰‹æœºç«¯ä¸“å±æè‡´å‹ç¼©æ ·å¼ --- */
        @media (max-width: 600px) {
            body { padding: 10px; }
            h1 { font-size: 1.1rem; margin-bottom: 15px; }
            .white-block { padding: 12px; margin-bottom: 12px; }
            .tag-btn { padding: 3px 8px; font-size: 0.75rem; }

            /* æ‰‹æœºç«¯å¡ç‰‡é«˜åº¦å˜ä½ */
            .item-card { height: 75px; margin-bottom: 8px; }
            .rarity-line { width: 4px; }
            .item-icon { width: 50px; height: 75px; border-right: none; }
            .item-info-box { padding: 0 10px; gap: 4px; }
            .item-name { font-size: 0.9rem; }
            .item-affixes { gap: 8px; }
            .affix-text { font-size: 0.7rem; }
            
            .item-farm-check { 
                width: 55px; 
                padding: 0; 
                border-left: 1px solid var(--border);
                flex-direction: column; 
                justify-content: center;
                font-size: 0.65rem; 
                gap: 2px;
            }
            .item-farm-check input { margin: 0; }
        }
    </style>
</head>
<body>

<div class="main-container">
    <h1>ç»ˆæœ«åœ°æ­¦å™¨åŸºè´¨ç­›é€‰å™¨</h1>

    <div class="white-block">
        <div class="block-header">è¯æ¡è¿‡æ»¤</div>
        <div id="filter-area">æ­£åœ¨è¯»å–æ•°æ®...</div>
    </div>

    <div id="list-area"></div>
</div>

<script>
    // å®šä¹‰ç­›é€‰å™¨ç»“æ„
    const filterConfig = {
        "èƒ½åŠ›å€¼æå‡": ["æ•æ·æå‡", "åŠ›é‡æå‡",  "æ„å¿—æå‡", "æ™ºè¯†æå‡", "ä¸»èƒ½åŠ›æå‡"],
        "å±æ€§æå‡": ["æ”»å‡»æå‡", "ç”Ÿå‘½æå‡", "ç‰©ç†ä¼¤å®³æå‡", "ç¼çƒ­ä¼¤å®³æå‡", "ç”µç£ä¼¤å®³æå‡", "å¯’å†·ä¼¤å®³æå‡", "è‡ªç„¶ä¼¤å®³æå‡", "æš´å‡»ç‡æå‡", "æºçŸ³æŠ€è‰ºæå‡", "ç»ˆç»“æŠ€æ•ˆç‡æå‡", "æ³•æœ¯ä¼¤å®³æå‡", "æ²»ç–—æ•ˆç‡æå‡"],
        "ç³»åˆ—æŠ€èƒ½": ["å¼ºæ”»", "å‹åˆ¶", "è¿½è¢­", "ç²‰ç¢", "æ˜‚æ‰¬", "å·§æŠ€", "æ®‹æš´", "é™„æœ¯", "åŒ»ç–—", "åˆ‡éª¨", "è¿›å‘", "å¤œå¹•", "æµè½¬", "æ•ˆç›Š"]
    };

    // çŠ¶æ€ç®¡ç†
    let equipmentData = []; // ç”¨äºå­˜æ”¾ä» json åŠ è½½çš„æ•°æ®
    let selectedTags = new Set();
    const FARMED_KEY = 'endfield_farmed_v1';
    let farmedMap = JSON.parse(localStorage.getItem(FARMED_KEY)) || {};

    // 1. è·å–æ•°æ®
    async function fetchData() {
        try {
            // è¿™é‡Œå‡è®¾ä½ çš„æ–‡ä»¶åæ˜¯ data.json
            const response = await fetch('data.json');
            equipmentData = await response.json();
            init();
        } catch (error) {
            console.error('æ— æ³•è¯»å– data.json:', error);
            document.getElementById('filter-area').innerText = 'é”™è¯¯ï¼šæ— æ³•è¯»å– data.json æ–‡ä»¶ï¼Œè¯·ç¡®è®¤æ–‡ä»¶æ˜¯å¦å­˜åœ¨äºåŒä¸€ç›®å½•ä¸‹ã€‚';
        }
    }

    // 2. æ ¸å¿ƒåˆå§‹åŒ–
    function init() {
        renderFilters();
        renderList();
    }

    function renderFilters() {
        const container = document.getElementById('filter-area');
        container.innerHTML = ''; // æ¸…é™¤åŠ è½½æç¤º
        for (const [groupName, tags] of Object.entries(filterConfig)) {
            const row = document.createElement('div');
            row.className = 'filter-row';
            row.innerHTML = `<div class="filter-label">${groupName}</div>`;
            
            const tagBox = document.createElement('div');
            tagBox.className = 'filter-tags';
            
            tags.forEach(tag => {
                const btn = document.createElement('button');
                btn.className = 'tag-btn';
                btn.textContent = tag;
                btn.onclick = () => {
                    btn.classList.toggle('active');
                    selectedTags.has(tag) ? selectedTags.delete(tag) : selectedTags.add(tag);
                    renderList();
                };
                tagBox.appendChild(btn);
            });
            
            row.appendChild(tagBox);
            container.appendChild(row);
        }
    }

    function renderList() {
        const container = document.getElementById('list-area');
        container.innerHTML = '';

        // ç­›é€‰é€»è¾‘
        const filtered = equipmentData.filter(item => {
            if (selectedTags.size === 0) return true;
            // æ£€æŸ¥ item æ˜¯å¦åŒ…å«é€‰ä¸­çš„æ‰€æœ‰æ ‡ç­¾
            return [...selectedTags].every(tag => 
                item["èƒ½åŠ›å€¼æå‡"] === tag || 
                item["å±æ€§æå‡"] === tag || 
                item["ç³»åˆ—æŠ€èƒ½"] === tag
            );
        });

        // æ’åºï¼šæŒ‰ç¨€æœ‰åº¦æƒé‡
        const weight = {"çº¢è‰²": 4, "é‡‘è‰²": 3, "ç´«è‰²": 2, "ç™½è‰²": 1};
        filtered.sort((a, b) => (weight[b["ç¨€æœ‰åº¦"]] || 0) - (weight[a["ç¨€æœ‰åº¦"]] || 0));

        filtered.forEach(item => {
            const card = document.createElement('div');
            card.className = 'item-card';
            
            // ç¨€æœ‰åº¦é¢œè‰²è·å–ï¼šä» CSS å˜é‡ä¸­è¯»å–
            const rColor = `var(--color-${item["ç¨€æœ‰åº¦"]})`;

            card.innerHTML = `
                <div class="rarity-line" style="background: ${rColor}"></div>
                <div class="item-icon">
                    ${item["å›¾ç‰‡URL"] ? `<img src="${item["å›¾ç‰‡URL"]}">` : 'No Img'}
                </div>
                <div class="item-name-box">
                    <div class="item-name" style="color: ${rColor}">${item["è£…å¤‡åç§°"]}</div>
                </div>
                <div class="item-affixes">
                    <span class="affix-text ${selectedTags.has(item["èƒ½åŠ›å€¼æå‡"]) ? 'match' : ''}">${item["èƒ½åŠ›å€¼æå‡"] || ''}</span>
                    <span class="affix-text ${selectedTags.has(item["å±æ€§æå‡"]) ? 'match' : ''}">${item["å±æ€§æå‡"] || ''}</span>
                    <span class="affix-text ${selectedTags.has(item["ç³»åˆ—æŠ€èƒ½"]) ? 'match' : ''}">${item["ç³»åˆ—æŠ€èƒ½"] || ''}</span>
                </div>
                <div class="item-farm-check">
                    <input type="checkbox" ${farmedMap[item["è£…å¤‡åç§°"]] ? 'checked' : ''} 
                        onchange="toggleFarmed('${item["è£…å¤‡åç§°"]}', this.checked)">
                    <span>å·²åˆ·å–</span>
                </div>
            `;
            container.appendChild(card);
        });
    }

    function toggleFarmed(name, isChecked) {
        farmedMap[name] = isChecked;
        localStorage.setItem(FARMED_KEY, JSON.stringify(farmedMap));
    }

    // å¯åŠ¨æ•°æ®è¯»å–
    fetchData();
</script>
</body>
</html>


